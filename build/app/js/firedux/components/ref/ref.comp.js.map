{"version":3,"sources":["firedux/components/ref/ref.comp.es6"],"names":[],"mappings":"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","file":"firedux/components/ref/ref.comp.js","sourcesContent":["(function () {\n  'use strict';\n  class Controller {\n    constructor($firedux) {\n      this.$firedux = $firedux;\n    }\n    $onChanges(changes) {\n      if (\n        changes.fdRefPath ||\n        changes.fdRefQuery\n      ) {\n        this.$ready =\n        this.$error =\n        this.$before = undefined;\n        this.updateRef(\n          this.fdRefPath,\n          this.fdRefQuery\n        );\n      }\n    }\n    updateRef(path, query) {\n      this.$before = true;\n      if (\n        angular.isObject(this.ref) &&\n        angular.isFunction(this.ref.off)\n      ) {\n        this.ref.off();\n      }\n      this.ref = this.getRef(path, query);\n      this.ref.on('value', snapshot => {\n        this.updateChanges(snapshot);\n      }, err => {\n        this.$before = undefined;\n        this.$error = err;\n        this.catch({\n          $error: err\n        });\n      });\n    }\n    getRef(path, query) {\n      let ref = this.$firedux.ref(path);\n      if (angular.isObject(query)) {\n        ref = this.getSortedRef(query, ref);\n        ref = this.getFilteredRef(query, ref);\n      }\n      return ref;\n    }\n    getSortedRef(query, ref) {\n      let returnable = ref;\n      if (query.orderByChild) {\n        returnable = ref\n          .orderByChild(query.orderByChild);\n      } else if (query.orderByKey) {\n        returnable = ref\n          .orderByKey(query.orderByKey);\n      } else if (query.orderByValue) {\n        returnable = ref\n          .orderByValue(query.orderByValue);\n      }\n      return returnable;\n    }\n    getFilteredRef(query, ref) {\n      let returnable = ref;\n      if (query.limitToFirst) {\n        returnable = ref\n          .limitToFirst(query.limitToFirst);\n      } else if (query.limitToLast) {\n        returnable = ref\n          .limitToLast(query.limitToLast);\n      } else if (query.startAt) {\n        returnable = ref\n          .startAt(query.startAt);\n      } else if (query.endAt) {\n        returnable = ref\n          .endAt(query.endAt);\n      } else if (query.equalTo) {\n        returnable = ref\n          .equalTo(query.equalTo);\n      }\n      return returnable;\n    }\n    updateChanges(snapshot) {\n      let array = [],\n          $index = 0;\n      if (this.fdRefQuery) {\n        snapshot.forEach(childSnapshot => {\n          array[$index] = childSnapshot.val();\n          $index++;\n        });\n        this.$before = undefined;\n        this.$ready = true;\n        this.then({\n          $data: array\n        });\n      } else {\n        this.$before = undefined;\n        this.$ready = true;\n        this.then({\n          $data: snapshot.val()\n        });\n      }\n    }\n  }\n  angular\n    .module('firedux.fdRef', [])\n    .component('fdRef', {\n      controller: Controller,\n      templateUrl: 'firedux/components/ref/ref.html',\n      transclude: {\n        before: '?before',\n        then: '?then',\n        catch: '?catch'\n      },\n      bindings: {\n        fdRefPath: '@',\n        fdRefQuery: '<',\n        then: '&',\n        catch: '&'\n      }\n    });\n}());\n"],"sourceRoot":"/source/"}
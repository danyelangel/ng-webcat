{"version":3,"sources":["firedux/components/ref/ref.comp.es6"],"names":[],"mappings":"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","file":"firedux/components/ref/ref.comp.js","sourcesContent":["(function () {\n  'use strict';\n  class Controller {\n    constructor($scope, $firedux, $timeout) {\n      this.$scope = $scope;\n      this.$firedux = $firedux;\n      this.$timeout = $timeout;\n    }\n    $onChanges(changes) {\n      if (\n        changes.fdRefPath ||\n        changes.fdRefPaths ||\n        changes.fdRefQuery ||\n        changes.fdRefArray\n      ) {\n        this.$ready =\n        this.$error =\n        this.$before = undefined;\n        if (this.fdRefPath) {\n          this.updateRef(\n            this.fdRefPath,\n            this.fdRefQuery,\n            this.fdRefArray\n          );\n        } else if (this.fdRefPaths) {\n          this.updateRefs(this.fdRefPaths);\n        }\n      }\n    }\n    // UPDATE REFS\n    updateRef(path, query, isArray) {\n      this.$before = true;\n      this.watchRef(path, query, snapshot => {\n        this.resolveChanges(isArray ? this.getArray(snapshot, isArray) : snapshot.val());\n      }, err => {\n        this.error(err);\n      });\n    }\n    updateRefs(paths) {\n      if (angular.isArray(paths)) {\n        Promise\n          .all(\n            this.getRefPromises(\n              this.getRefDefinitions(paths)\n            ))\n          .then(results => {\n            this.resolveChanges(results);\n          });\n      }\n    }\n    // CREATE REFS\n    getRefDefinitions(paths) {\n      let refs = [];\n      angular.forEach(paths, path => {\n        if (angular.isString(path)) {\n          refs.push({\n            ref: this.getRef(path),\n            array: false\n          });\n        } else if (\n          angular.isObject(path) &&\n          angular.isString(path.path)\n        ) {\n          refs.push({\n            ref: this.getRef(path.path),\n            array: path.array\n          });\n        } else {\n          console.error('The path object was incorrectly formatted: ', path);\n        }\n      });\n      return refs;\n    }\n    getRef(path, query) {\n      let ref = this.$firedux.ref(path);\n      if (angular.isObject(query)) {\n        ref = this.getSortedRef(query, ref);\n        ref = this.getFilteredRef(query, ref);\n      }\n      return ref;\n    }\n    getSortedRef(query = {}, ref = {}) {\n      let returnable = ref;\n      if (query.orderByChild) {\n        returnable = ref\n          .orderByChild(query.orderByChild);\n      } else if (query.orderByKey) {\n        returnable = ref\n          .orderByKey();\n      } else if (query.orderByValue) {\n        returnable = ref\n          .orderByValue();\n      }\n      return returnable;\n    }\n    getFilteredRef(query = {}, ref = {}) {\n      let returnable = ref;\n      if (query.limitToFirst) {\n        returnable = returnable\n          .limitToFirst(query.limitToFirst);\n      }\n      if (query.limitToLast) {\n        returnable = returnable\n          .limitToLast(query.limitToLast);\n      }\n      if (query.startAt) {\n        returnable = returnable\n          .startAt(query.startAt);\n      }\n      if (query.endAt) {\n        returnable = returnable\n          .endAt(query.endAt);\n      }\n      if (angular.isDefined(query.equalTo)) {\n        returnable = returnable\n          .equalTo(query.equalTo);\n      }\n      return returnable;\n    }\n    // GET DATA\n    getRefPromises(refs) {\n      let promises;\n      angular.forEach(refs, item => {\n        promises.push(item\n          .once('value')\n          .then(snap => {\n            return item.array ? this.getArray(snap, item.array) : snap.val();\n          }));\n      });\n      return promises;\n    }\n    watchRef(path, query, then, err) {\n      if (\n        angular.isObject(this.ref) &&\n        angular.isFunction(this.ref.off)\n      ) {\n        this.ref.off();\n      }\n      this.ref = this.getRef(path, query);\n      this.ref.on('value', then, err);\n    }\n    // TRANSFORM DATA\n    getArray(snapshot, arrayType) {\n      let array = [];\n      snapshot.forEach(childSnapshot => {\n        if (arrayType === 'rich' && angular.isObject(childSnapshot.val())) {\n          array.push(Object.assign({\n            key: childSnapshot.key\n          }, childSnapshot.val()));\n        } else if (arrayType === 'rich' && !angular.isObject(childSnapshot.val())) {\n          array.push({\n            key: childSnapshot.key,\n            value: childSnapshot.val()\n          });\n        } else {\n          array.push(childSnapshot.val());\n        }\n      });\n      return array;\n    }\n    // HANDLE ERRORS\n    error(err) {\n      console.warn(err);\n      this.$before = undefined;\n      this.$error = err;\n      this.catch({\n        $error: err\n      });\n      this.$scope.$apply();\n    }\n    // FINAL OUTPUT\n    resolveChanges($data) {\n      this.$before = undefined;\n      this.$ready = true;\n      this.then({\n        $data\n      });\n      this.$timeout(() => {\n        this.$scope.$apply();\n      });\n    }\n  }\n  angular\n    .module('firedux.fdRef', [])\n    .component('fdRef', {\n      controller: Controller,\n      templateUrl: 'firedux/components/ref/ref.html',\n      transclude: {\n        before: '?before',\n        then: '?then',\n        catch: '?catch'\n      },\n      bindings: {\n        fdRefPath: '@',\n        fdRefPaths: '<',\n        fdRefQuery: '<',\n        fdRefArray: '@',\n        then: '&',\n        catch: '&'\n      }\n    });\n}());\n"],"sourceRoot":"/source/"}